{"version":3,"file":"react-spring-rafz.esm.js","sources":["../../../../../node_modules/@react-spring/rafz/dist/react-spring-rafz.esm.js"],"sourcesContent":["let updateQueue = makeQueue();\nconst raf = fn => schedule(fn, updateQueue);\nlet writeQueue = makeQueue();\n\nraf.write = fn => schedule(fn, writeQueue);\n\nlet onStartQueue = makeQueue();\n\nraf.onStart = fn => schedule(fn, onStartQueue);\n\nlet onFrameQueue = makeQueue();\n\nraf.onFrame = fn => schedule(fn, onFrameQueue);\n\nlet onFinishQueue = makeQueue();\n\nraf.onFinish = fn => schedule(fn, onFinishQueue);\n\nlet timeouts = [];\n\nraf.setTimeout = (handler, ms) => {\n  let time = raf.now() + ms;\n\n  let cancel = () => {\n    let i = timeouts.findIndex(t => t.cancel == cancel);\n    if (~i) timeouts.splice(i, 1);\n    pendingCount -= ~i ? 1 : 0;\n  };\n\n  let timeout = {\n    time,\n    handler,\n    cancel\n  };\n  timeouts.splice(findTimeout(time), 0, timeout);\n  pendingCount += 1;\n  start();\n  return timeout;\n};\n\nlet findTimeout = time => ~(~timeouts.findIndex(t => t.time > time) || ~timeouts.length);\n\nraf.cancel = fn => {\n  onStartQueue.delete(fn);\n  onFrameQueue.delete(fn);\n  updateQueue.delete(fn);\n  writeQueue.delete(fn);\n  onFinishQueue.delete(fn);\n};\n\nraf.sync = fn => {\n  sync = true;\n  raf.batchedUpdates(fn);\n  sync = false;\n};\n\nraf.throttle = fn => {\n  let lastArgs;\n\n  function queuedFn() {\n    try {\n      fn(...lastArgs);\n    } finally {\n      lastArgs = null;\n    }\n  }\n\n  function throttled(...args) {\n    lastArgs = args;\n    raf.onStart(queuedFn);\n  }\n\n  throttled.handler = fn;\n\n  throttled.cancel = () => {\n    onStartQueue.delete(queuedFn);\n    lastArgs = null;\n  };\n\n  return throttled;\n};\n\nlet nativeRaf = typeof window != 'undefined' ? window.requestAnimationFrame : () => {};\n\nraf.use = impl => nativeRaf = impl;\n\nraf.now = typeof performance != 'undefined' ? () => performance.now() : Date.now;\n\nraf.batchedUpdates = fn => fn();\n\nraf.catch = console.error;\nraf.frameLoop = 'always';\n\nraf.advance = () => {\n  if (raf.frameLoop !== 'demand') {\n    console.warn('Cannot call the manual advancement of rafz whilst frameLoop is not set as demand');\n  } else {\n    update();\n  }\n};\n\nlet ts = -1;\nlet pendingCount = 0;\nlet sync = false;\n\nfunction schedule(fn, queue) {\n  if (sync) {\n    queue.delete(fn);\n    fn(0);\n  } else {\n    queue.add(fn);\n    start();\n  }\n}\n\nfunction start() {\n  if (ts < 0) {\n    ts = 0;\n\n    if (raf.frameLoop !== 'demand') {\n      nativeRaf(loop);\n    }\n  }\n}\n\nfunction stop() {\n  ts = -1;\n}\n\nfunction loop() {\n  if (~ts) {\n    nativeRaf(loop);\n    raf.batchedUpdates(update);\n  }\n}\n\nfunction update() {\n  let prevTs = ts;\n  ts = raf.now();\n  let count = findTimeout(ts);\n\n  if (count) {\n    eachSafely(timeouts.splice(0, count), t => t.handler());\n    pendingCount -= count;\n  }\n\n  onStartQueue.flush();\n  updateQueue.flush(prevTs ? Math.min(64, ts - prevTs) : 16.667);\n  onFrameQueue.flush();\n  writeQueue.flush();\n  onFinishQueue.flush();\n\n  if (!pendingCount) {\n    stop();\n  }\n}\n\nfunction makeQueue() {\n  let next = new Set();\n  let current = next;\n  return {\n    add(fn) {\n      pendingCount += current == next && !next.has(fn) ? 1 : 0;\n      next.add(fn);\n    },\n\n    delete(fn) {\n      pendingCount -= current == next && next.has(fn) ? 1 : 0;\n      return next.delete(fn);\n    },\n\n    flush(arg) {\n      if (current.size) {\n        next = new Set();\n        pendingCount -= current.size;\n        eachSafely(current, fn => fn(arg) && next.add(fn));\n        pendingCount += next.size;\n        current = next;\n      }\n    }\n\n  };\n}\n\nfunction eachSafely(values, each) {\n  values.forEach(value => {\n    try {\n      each(value);\n    } catch (e) {\n      raf.catch(e);\n    }\n  });\n}\n\nconst __raf = {\n  count() {\n    return pendingCount;\n  },\n\n  isRunning() {\n    return ts >= 0;\n  },\n\n  clear() {\n    ts = -1;\n    timeouts = [];\n    onStartQueue = makeQueue();\n    updateQueue = makeQueue();\n    onFrameQueue = makeQueue();\n    writeQueue = makeQueue();\n    onFinishQueue = makeQueue();\n    pendingCount = 0;\n  }\n\n};\n\nexport { __raf, raf };\n"],"names":["updateQueue","makeQueue","raf","fn","schedule","writeQueue","write","onStartQueue","onStart","onFrameQueue","onFrame","onFinishQueue","onFinish","timeouts","setTimeout","handler","ms","time","now","cancel","i","findIndex","t","splice","pendingCount","timeout","findTimeout","start","length","sync","batchedUpdates","throttle","lastArgs","queuedFn","throttled","args","nativeRaf","window","requestAnimationFrame","use","impl","performance","Date","console","error","frameLoop","advance","warn","update","ts","queue","add","loop","stop","prevTs","count","eachSafely","flush","Math","min","next","Set","current","has","arg","size","values","each","forEach","value","e"],"mappings":"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"}